{% extends "common/base-list-modern.html" %}
{% load static %}
{% load i18n %}

{% block list_icon %}
<svg class="w-6 h-6 sm:w-7 sm:h-7" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
{% endblock %}

{% block list_title %}{% trans "Employee Detailed Attendance Report" %}{% endblock %}
{% block list_subtitle %}{% trans "Comprehensive daily attendance analysis for individual employees with advanced metrics and intelligent insights" %}{% endblock %}

{% block list_actions %}
<div class="flex gap-3">
<button id="generate-detailed-report-btn" class="inline-flex items-center justify-center gap-2 rounded-lg text-sm font-medium bg-gradient-to-r from-blue-600 to-blue-700 text-white hover:from-blue-700 hover:to-blue-800 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 px-5 py-2.5 shadow-md">
<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
{% trans "Generate Detailed Report" %}
</button>
</div>
{% endblock %}

{% block search_filter %}
{% if report_generated %}
<div class="flex flex-wrap justify-center gap-3 p-4 bg-white shadow-md rounded-lg border border-gray-200">
<input type="text" id="search-detailed-report" placeholder="{% trans 'Search by Date, Status, or Shift...' %}" class="w-full sm:w-auto flex-1 rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700 transition-all duration-200 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
<select id="status-filter-detailed" class="rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700">
<option value="">{% trans "All Status" %}</option>
<option value="Present">{% trans "Present" %}</option>
<option value="Absent">{% trans "Absent" %}</option>
<option value="Late">{% trans "Late" %}</option>
<option value="Leave">{% trans "Leave" %}</option>
<option value="Half Day">{% trans "Half Day" %}</option>
</select>
<select id="shift-filter-detailed" class="rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700">
<option value="">{% trans "All Shifts" %}</option>
{% for record in daily_records %}
    {% if record.shift_name and record.shift_name not in shift_names %}
        <option value="{{ record.shift_name }}">{{ record.shift_name }}</option>
    {% endif %}
{% endfor %}
</select>
</div>

<!-- Table Controls -->
<div class="flex flex-wrap justify-between items-center gap-3 p-4 bg-gray-50 border border-gray-200 rounded-lg mt-3">
<div class="flex flex-wrap gap-2">
<button id="column-visibility-btn" class="inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all">
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"></path>
    </svg>
    {% trans "Columns" %}
</button>
<button id="print-detailed-btn" class="inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-blue-600 border border-blue-600 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all">
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
    </svg>
    {% trans "Print" %}
</button>
<button id="copy-detailed-btn" class="inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all">
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
    </svg>
    {% trans "Copy" %}
</button>
<button id="export-excel-btn" class="inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-green-700 bg-green-50 border border-green-300 rounded-lg hover:bg-green-100 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all">
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
    </svg>
    {% trans "Excel" %}
</button>
</div>
<div class="text-sm text-gray-600">
<span id="visible-rows-count">{{ total_days|default:0 }}</span> {% trans "days" %}
</div>
</div>

<!-- Column Visibility Panel -->
<div id="column-visibility-panel" class="hidden bg-white border border-gray-200 rounded-lg p-4 mt-3 shadow-sm">
<h4 class="text-sm font-medium text-gray-900 mb-3">{% trans "Show/Hide Columns" %}</h4>
<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2" id="column-toggles">
<!-- Column toggles will be populated by JavaScript -->
</div>
<div class="flex gap-2 mt-4 pt-3 border-t border-gray-200">
<button id="show-all-columns" class="px-3 py-1 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded hover:bg-blue-100 transition-all">
    {% trans "Show All" %}
</button>
<button id="hide-all-columns" class="px-3 py-1 text-xs font-medium text-gray-600 bg-gray-50 border border-gray-200 rounded hover:bg-gray-100 transition-all">
    {% trans "Hide All" %}
</button>
<button id="reset-columns" class="px-3 py-1 text-xs font-medium text-green-600 bg-green-50 border border-green-200 rounded hover:bg-green-100 transition-all">
    {% trans "Reset" %}
</button>
</div>
</div>
{% endif %}
{% endblock %}

{% block table_body %}
{% if report_generated %}

<!-- Employee Information Header -->
<div class="bg-white rounded-lg shadow-md mb-6">
<div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-lg">
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
    <div>
        <h3 class="text-lg font-bold">{{ employee_info.employee_name }}</h3>
        <p class="text-sm opacity-90">ID: {{ employee_info.employee_id }}</p>
    </div>
    <div>
        <p class="text-sm opacity-75">{% trans "Department" %}</p>
        <p class="font-medium">{{ employee_info.department }}</p>
    </div>
    <div>
        <p class="text-sm opacity-75">{% trans "Designation" %}</p>
        <p class="font-medium">{{ employee_info.designation }}</p>
    </div>
    <div>
        <p class="text-sm opacity-75">{% trans "Default Shift" %}</p>
        <p class="font-medium">{{ employee_info.default_shift }}</p>
    </div>
</div>
</div>

<!-- Summary Statistics -->
<div class="p-6 bg-gray-50 border-b border-gray-200">
<h4 class="text-lg font-semibold text-gray-900 mb-4">{% trans "Summary Statistics" %}</h4>
<div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
    <div class="bg-white p-4 rounded-lg border border-gray-200">
        <div class="text-2xl font-bold text-green-600">{{ summary_stats.present_days }}</div>
        <div class="text-sm text-gray-600">{% trans "Present Days" %}</div>
    </div>
    <div class="bg-white p-4 rounded-lg border border-gray-200">
        <div class="text-2xl font-bold text-red-600">{{ summary_stats.absent_days }}</div>
        <div class="text-sm text-gray-600">{% trans "Absent Days" %}</div>
    </div>
    <div class="bg-white p-4 rounded-lg border border-gray-200">
        <div class="text-2xl font-bold text-yellow-600">{{ summary_stats.late_days }}</div>
        <div class="text-sm text-gray-600">{% trans "Late Days" %}</div>
    </div>
    <div class="bg-white p-4 rounded-lg border border-gray-200">
        <div class="text-2xl font-bold text-blue-600">{{ summary_stats.leave_days }}</div>
        <div class="text-sm text-gray-600">{% trans "Leave Days" %}</div>
    </div>
    <div class="bg-white p-4 rounded-lg border border-gray-200">
        <div class="text-2xl font-bold text-purple-600">{{ summary_stats.total_working_hours }}h</div>
        <div class="text-sm text-gray-600">{% trans "Working Hours" %}</div>
    </div>
    <div class="bg-white p-4 rounded-lg border border-gray-200">
        <div class="text-2xl font-bold text-indigo-600">{{ summary_stats.attendance_percentage }}%</div>
        <div class="text-sm text-gray-600">{% trans "Attendance %" %}</div>
    </div>
</div>
</div>

<!-- Period Overview -->
<div class="p-6 rounded-b-lg">
<h4 class="text-lg font-semibold text-gray-900 mb-4">{% trans "Period Overview" %}</h4>
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
    <div class="bg-blue-50 p-3 rounded">
        <div class="font-medium text-blue-800">{% trans "Period" %}</div>
        <div class="text-blue-600">{{ start_date|date:"M d, Y" }} - {{ end_date|date:"M d, Y" }}</div>
    </div>
    <div class="bg-green-50 p-3 rounded">
        <div class="font-medium text-green-800">{% trans "Total Days" %}</div>
        <div class="text-green-600">{{ period_overview.total_days }}</div>
    </div>
    <div class="bg-purple-50 p-3 rounded">
        <div class="font-medium text-purple-800">{% trans "Working Days" %}</div>
        <div class="text-purple-600">{{ period_overview.working_days }}</div>
    </div>
    <div class="bg-yellow-50 p-3 rounded">
        <div class="font-medium text-yellow-800">{% trans "Category" %}</div>
        <div class="text-yellow-600">{{ summary_stats.attendance_category }}</div>
    </div>
</div>
</div>
</div>

<!-- Daily Attendance Records Table -->
<div class="bg-white rounded-lg shadow-md">
<div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 rounded-t-lg">
<h3 class="text-lg font-bold">{% trans "Daily Attendance Records" %} ({{ total_days }} {% trans "days" %})</h3>
<p class="text-sm opacity-90">{% trans "Period:" %} {{ start_date|date:"M d, Y" }} - {{ end_date|date:"M d, Y" }}</p>
</div>

<div class="w-full overflow-x-auto overflow-y-auto max-h-[70vh] relative">
<table id="detailed-report-table" class="w-full border-collapse min-w-max">
    <thead class="bg-gray-50 text-gray-700 sticky top-0 z-10">
        <tr>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[100px]" data-column="date">
                {% trans "DATE" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[80px]" data-column="day">
                {% trans "DAY" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[80px]" data-column="status">
                {% trans "STATUS" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[100px]" data-column="in_time">
                {% trans "CHECK IN" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[100px]" data-column="out_time">
                {% trans "CHECK OUT" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[90px]" data-column="working_hours">
                {% trans "WORKING HOURS" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[80px]" data-column="late_minutes">
                {% trans "LATE MIN" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[80px]" data-column="early_out_minutes">
                {% trans "EARLY OUT" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[90px]" data-column="overtime_hours">
                {% trans "OVERTIME" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[100px]" data-column="shift_name">
                {% trans "SHIFT" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[80px]" data-column="shift_source">
                {% trans "SHIFT SOURCE" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[80px]" data-column="total_logs">
                {% trans "LOGS" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[90px]" data-column="break_time_minutes">
                {% trans "BREAK TIME" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[80px]" data-column="is_holiday">
                {% trans "HOLIDAY" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[80px]" data-column="is_weekend">
                {% trans "WEEKEND" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[100px]" data-column="dynamic_shift_used">
                {% trans "DYNAMIC SHIFT" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[100px]" data-column="converted_from_minimum_hours">
                {% trans "ðŸ”¥ MIN HOURS" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[100px]" data-column="converted_to_half_day">
                {% trans "ðŸ”¥ HALF DAY" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[120px]" data-column="converted_from_incomplete_punch">
                {% trans "ðŸ”¥ INCOMPLETE" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[120px]" data-column="excessive_working_hours_flag">
                {% trans "ðŸ”¥ EXCESSIVE HRS" %}
            </th>
            <th class="px-2 py-3 text-xs font-medium text-center border border-gray-300 min-w-[100px]" data-column="flag_reason">
                {% trans "ðŸ”¥ FLAG REASON" %}
            </th>
        </tr>
    </thead>
    <tbody>
    {% for record in daily_records %}
        <tr class="bg-white border-b border-gray-200 hover:bg-gray-50 transition-colors detailed-row"
            data-status="{{ record.status_display }}"
            data-shift="{{ record.shift_name }}"
            data-date="{{ record.date|date:'Y-m-d' }}">
            
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="date">
                <div class="font-medium">{{ record.date|date:"M d" }}</div>
                <div class="text-gray-500">{{ record.date|date:"Y" }}</div>
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="day">
                {{ record.day_name }}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="status">
                {% if record.status == "PRE" %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">{{ record.status_display }}</span>
                {% elif record.status == "ABS" %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">{{ record.status_display }}</span>
                {% elif record.status == "LAT" %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">{{ record.status_display }}</span>
                {% elif record.status == "LEA" %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">{{ record.status_display }}</span>
                {% elif record.status == "HAL" %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-orange-100 text-orange-800">{{ record.status_display }}</span>
                {% else %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">{{ record.status_display }}</span>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="in_time">
                {% if record.in_time %}
                    <div class="font-medium">{{ record.in_time|date:"H:i" }}</div>
                    <div class="text-gray-500">{{ record.in_time|date:"M d" }}</div>
                {% else %}
                    <span class="text-gray-400">--:--</span>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="out_time">
                {% if record.out_time %}
                    <div class="font-medium">{{ record.out_time|date:"H:i" }}</div>
                    <div class="text-gray-500">{{ record.out_time|date:"M d" }}</div>
                {% else %}
                    <span class="text-gray-400">--:--</span>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="working_hours">
                <span class="font-bold text-purple-600">{{ record.working_hours }}h</span>
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="late_minutes">
                {% if record.late_minutes > 0 %}
                    <span class="font-bold text-red-600">{{ record.late_minutes }}</span>
                {% else %}
                    <span class="text-gray-400">0</span>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="early_out_minutes">
                {% if record.early_out_minutes > 0 %}
                    <span class="font-bold text-orange-600">{{ record.early_out_minutes }}</span>
                {% else %}
                    <span class="text-gray-400">0</span>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="overtime_hours">
                {% if record.overtime_hours > 0 %}
                    <span class="font-bold text-indigo-600">{{ record.overtime_hours }}h</span>
                {% else %}
                    <span class="text-gray-400">0h</span>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="shift_name">
                <div class="font-medium">{{ record.shift_name }}</div>
                {% if record.shift_start_time and record.shift_end_time %}
                    <div class="text-gray-500">{{ record.shift_start_time|date:"H:i" }}-{{ record.shift_end_time|date:"H:i" }}</div>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="shift_source">
                {% if record.shift_source == "Dynamic" %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-cyan-100 text-cyan-800">{{ record.shift_source }}</span>
                {% elif record.shift_source == "Roster" %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">{{ record.shift_source }}</span>
                {% elif record.shift_source == "Default" %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">{{ record.shift_source }}</span>
                {% else %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">{{ record.shift_source }}</span>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="total_logs">
                <span class="font-medium">{{ record.total_logs }}</span>
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="break_time_minutes">
                {% if record.break_time_minutes > 0 %}
                    <span class="font-medium text-purple-600">{{ record.break_time_minutes }}m</span>
                {% else %}
                    <span class="text-gray-400">0m</span>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="is_holiday">
                {% if record.is_holiday %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">Yes</span>
                {% else %}
                    <span class="text-gray-400">No</span>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="is_weekend">
                {% if record.is_weekend %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">Yes</span>
                {% else %}
                    <span class="text-gray-400">No</span>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="dynamic_shift_used">
                {% if record.dynamic_shift_used %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-cyan-100 text-cyan-800">ðŸ”¥ Yes</span>
                {% else %}
                    <span class="text-gray-400">No</span>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="converted_from_minimum_hours">
                {% if record.converted_from_minimum_hours %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">ðŸ”¥ Yes</span>
                {% else %}
                    <span class="text-gray-400">No</span>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="converted_to_half_day">
                {% if record.converted_to_half_day %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-orange-100 text-orange-800">ðŸ”¥ Yes</span>
                {% else %}
                    <span class="text-gray-400">No</span>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="converted_from_incomplete_punch">
                {% if record.converted_from_incomplete_punch %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">ðŸ”¥ Yes</span>
                {% else %}
                    <span class="text-gray-400">No</span>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="excessive_working_hours_flag">
                {% if record.excessive_working_hours_flag %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800">ðŸ”¥ Yes</span>
                {% else %}
                    <span class="text-gray-400">No</span>
                {% endif %}
            </td>
            <td class="px-2 py-2 text-xs text-center border border-gray-300" data-column="flag_reason">
                {% if record.flag_reason %}
                    <span class="text-red-600 font-medium">{{ record.flag_reason }}</span>
                {% else %}
                    <span class="text-gray-400">--</span>
                {% endif %}
            </td>
        </tr>
    {% empty %}
        <tr class="bg-white border-b border-gray-200">
            <td colspan="20" class="px-4 py-8 text-center text-sm border border-gray-300">
                <div class="flex flex-col items-center justify-center space-y-4">
                    <div class="rounded-full bg-gray-100 p-4">
                        <svg class="h-8 w-8 text-gray-400" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="text-center">
                        <h3 class="text-base font-medium">{% trans "No Attendance Data Found" %}</h3>
                        <p class="text-gray-500 text-sm">{% trans "No attendance records found for the selected employee and date range." %}</p>
                    </div>
                </div>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>
</div>

<!-- Configuration Applied Footer -->
<div class="bg-gray-50 border-t border-gray-200 p-4 rounded-b-lg">
<div class="text-sm">
    <h4 class="font-semibold text-gray-800 mb-3">{% trans "Configuration Applied" %}</h4>
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 text-xs">
        <div class="bg-blue-100 p-2 rounded">
            <div class="font-medium text-blue-800">{% trans "Grace Minutes" %}</div>
            <div class="text-blue-600">{{ form_data.grace_minutes|default:"15" }}</div>
        </div>
        <div class="bg-green-100 p-2 rounded">
            <div class="font-medium text-green-800">{% trans "Early Out Threshold" %}</div>
            <div class="text-green-600">{{ form_data.early_out_threshold_minutes|default:"30" }} min</div>
        </div>
        <div class="bg-purple-100 p-2 rounded">
            <div class="font-medium text-purple-800">{% trans "Overtime Start" %}</div>
            <div class="text-purple-600">{{ form_data.overtime_start_after_minutes|default:"15" }} min</div>
        </div>
        <div class="bg-yellow-100 p-2 rounded">
            <div class="font-medium text-yellow-800">{% trans "Min Overtime" %}</div>
            <div class="text-yellow-600">{{ form_data.minimum_overtime_minutes|default:"60" }} min</div>
        </div>
        {% if form_data.enable_dynamic_shift_detection %}
        <div class="bg-cyan-100 p-2 rounded">
            <div class="font-medium text-cyan-800">{% trans "Dynamic Shifts" %}</div>
            <div class="text-cyan-600">{% trans "Enabled" %}</div>
        </div>
        {% endif %}
        <div class="bg-indigo-100 p-2 rounded">
            <div class="font-medium text-indigo-800">{% trans "Break Time" %}</div>
            <div class="text-indigo-600">{{ form_data.default_break_minutes|default:"60" }} min</div>
        </div>
    </div>
</div>
</div>
</div>

{% else %}
<div class="text-center py-12 bg-white rounded-lg border border-gray-200">
<svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
</svg>
<h3 class="text-lg font-medium text-gray-900 mb-2">{% trans "Generate Employee Detailed Attendance Report" %}</h3>
<p class="text-gray-500">{% trans "Click the Generate Detailed Report button to create a comprehensive daily attendance analysis for an individual employee with advanced metrics and insights." %}</p>
</div>
{% endif %}
{% endblock %}

{% block extra_css %}
<style>
#detailed-report-table {
border-collapse: collapse;
}

#detailed-report-table th,
#detailed-report-table td {
border: 1px solid #d1d5db;
white-space: nowrap;
}

#detailed-report-table thead th {
background-color: #f9fafb;
color: #374151;
font-weight: 600;
position: sticky;
top: 0;
z-index: 10;
}

/* Responsive table adjustments */
@media (max-width: 768px) {
#detailed-report-table {
font-size: 0.75rem;
}

#detailed-report-table th,
#detailed-report-table td {
padding: 0.25rem;
min-width: 60px;
}
}

.loading-overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(255, 255, 255, 0.9);
backdrop-filter: blur(5px);
display: flex;
align-items: center;
justify-content: center;
z-index: 9999;
opacity: 0;
visibility: hidden;
transition: all 0.3s ease;
}

.loading-overlay.active {
opacity: 1;
visibility: visible;
}

.loading-spinner {
width: 50px;
height: 50px;
border: 4px solid #f3f4f6;
border-top: 4px solid #2563eb;
border-radius: 50%;
animation: spin 1s linear infinite;
margin-bottom: 15px;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

.animate-fade-in {
animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}

/* Tab Styles */
.tab-nav {
display: flex;
background: #f3f4f6;
border-radius: 0.5rem;
padding: 0.25rem;
}

.tab-button {
flex: 1;
padding: 0.75rem 1.5rem;
text-align: center;
border-radius: 0.375rem;
font-weight: 500;
font-size: 0.875rem;
transition: all 0.2s;
cursor: pointer;
border: none;
background: transparent;
color: #6b7280;
}

.tab-button.active {
background: white;
color: #1f2937;
box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
}

.tab-button:hover:not(.active) {
color: #374151;
background: #e5e7eb;
}

.tab-content {
display: none;
padding: 1.5rem 0;
}

.tab-content.active {
display: block;
animation: fadeIn 0.3s ease-in-out;
}

/* Form field visibility */
.field-group {
transition: all 0.3s ease;
}

.field-group.hidden {
display: none !important;
}

/* Modal backdrop */
.modal-backdrop {
background-color: rgba(0, 0, 0, 0.5);
backdrop-filter: blur(4px);
}

.modal-content {
pointer-events: auto;
}

/* Column visibility styles */
.column-hidden {
display: none !important;
}

/* Copy notification */
.copy-notification {
position: fixed;
top: 20px;
right: 20px;
background: #2563eb;
color: white;
padding: 12px 24px;
border-radius: 8px;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
z-index: 10000;
transform: translateX(100%);
transition: transform 0.3s ease;
}

.copy-notification.show {
transform: translateX(0);
}

/* Print styles */
@media print {
body * {
visibility: hidden;
}

#detailed-report-table,
#detailed-report-table * {
visibility: visible;
}

#detailed-report-table {
position: absolute;
left: 0;
top: 0;
width: 100% !important;
font-size: 10px;
}

.column-hidden {
display: none !important;
}
}
</style>
{% endblock %}

{% block extra_js %}
<!-- PrintJS CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/print-js/1.6.0/print.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/print-js/1.6.0/print.min.css">

<script>
document.addEventListener('DOMContentLoaded', function() {

// Loading overlay
const loadingOverlay = document.createElement('div');
loadingOverlay.className = 'loading-overlay';
loadingOverlay.innerHTML = `
<div class="text-center">
    <div class="loading-spinner"></div>
    <div class="text-lg font-semibold text-gray-700">{% trans "Generating Employee Detailed Attendance Report..." %}</div>
    <div class="text-sm text-gray-500 mt-2">{% trans "Processing daily attendance data with advanced analytics" %}</div>
</div>
`;
document.body.appendChild(loadingOverlay);

// Column visibility management (EXACT SAME as summary report)
const columnVisibilityState = {
date: true,
day: true,
status: true,
in_time: true,
out_time: true,
working_hours: true,
late_minutes: true,
early_out_minutes: true,
overtime_hours: true,
shift_name: true,
shift_source: false,
total_logs: false,
break_time_minutes: false,
is_holiday: false,
is_weekend: false,
dynamic_shift_used: false,
converted_from_minimum_hours: false,
converted_to_half_day: false,
converted_from_incomplete_punch: false,
excessive_working_hours_flag: false,
flag_reason: false
};

// Initialize column visibility controls (EXACT SAME as summary report)
function initializeColumnVisibility() {
const table = document.getElementById('detailed-report-table');
if (!table) return;

const headers = table.querySelectorAll('thead th[data-column]');
const togglesContainer = document.getElementById('column-toggles');

if (!togglesContainer) return;

togglesContainer.innerHTML = '';

headers.forEach(header => {
    const columnName = header.dataset.column;
    const columnText = header.textContent.trim();
    
    const toggle = document.createElement('label');
    toggle.className = 'flex items-center p-2 bg-gray-50 rounded border border-gray-200 hover:bg-gray-100 cursor-pointer text-xs';
    toggle.innerHTML = `
        <input type="checkbox" class="h-3 w-3 text-blue-600 focus:ring-blue-500 border-gray-300 rounded mr-2" 
               data-column="${columnName}" ${columnVisibilityState[columnName] ? 'checked' : ''}>
        <span class="text-gray-700">${columnText}</span>
    `;
    
    togglesContainer.appendChild(toggle);
    
    const checkbox = toggle.querySelector('input');
    checkbox.addEventListener('change', function() {
        toggleColumn(columnName, this.checked);
    });
});
}

// Toggle column visibility (EXACT SAME as summary report)
function toggleColumn(columnName, visible) {
columnVisibilityState[columnName] = visible;

const table = document.getElementById('detailed-report-table');
if (!table) return;

const elements = table.querySelectorAll(`[data-column="${columnName}"]`);
elements.forEach(element => {
    if (visible) {
        element.classList.remove('column-hidden');
    } else {
        element.classList.add('column-hidden');
    }
});

updateVisibleRowsCount();
}

// Update visible rows count
function updateVisibleRowsCount() {
const visibleRows = document.querySelectorAll('#detailed-report-table tbody tr:not([style*="display: none"])');
const countElement = document.getElementById('visible-rows-count');
if (countElement) {
    countElement.textContent = visibleRows.length;
}
}

// Column visibility panel toggle
const columnVisibilityBtn = document.getElementById('column-visibility-btn');
const columnVisibilityPanel = document.getElementById('column-visibility-panel');

if (columnVisibilityBtn && columnVisibilityPanel) {
columnVisibilityBtn.addEventListener('click', function() {
    columnVisibilityPanel.classList.toggle('hidden');
});
}

// Show/Hide all columns (EXACT SAME as summary report)
const showAllBtn = document.getElementById('show-all-columns');
const hideAllBtn = document.getElementById('hide-all-columns');
const resetBtn = document.getElementById('reset-columns');

if (showAllBtn) {
showAllBtn.addEventListener('click', function() {
    Object.keys(columnVisibilityState).forEach(column => {
        columnVisibilityState[column] = true;
        toggleColumn(column, true);
    });
    
    document.querySelectorAll('#column-toggles input[type="checkbox"]').forEach(cb => {
        cb.checked = true;
    });
});
}

if (hideAllBtn) {
hideAllBtn.addEventListener('click', function() {
    Object.keys(columnVisibilityState).forEach(column => {
        if (column !== 'date' && column !== 'status' && column !== 'working_hours') {
            columnVisibilityState[column] = false;
            toggleColumn(column, false);
        }
    });
    
    document.querySelectorAll('#column-toggles input[type="checkbox"]').forEach(cb => {
        const column = cb.dataset.column;
        cb.checked = column === 'date' || column === 'status' || column === 'working_hours';
    });
});
}

if (resetBtn) {
resetBtn.addEventListener('click', function() {
    const defaultColumns = ['date', 'day', 'status', 'in_time', 'out_time', 'working_hours', 'late_minutes', 'early_out_minutes', 'overtime_hours', 'shift_name'];
    
    Object.keys(columnVisibilityState).forEach(column => {
        const visible = defaultColumns.includes(column);
        columnVisibilityState[column] = visible;
        toggleColumn(column, visible);
    });
    
    document.querySelectorAll('#column-toggles input[type="checkbox"]').forEach(cb => {
        const column = cb.dataset.column;
        cb.checked = defaultColumns.includes(column);
    });
});
}

// Print functionality (EXACT SAME as summary report)
const printBtn = document.getElementById('print-detailed-btn');
if (printBtn) {
printBtn.addEventListener('click', function() {
    const table = document.getElementById('detailed-report-table');
    if (!table) return;

    const tableClone = table.cloneNode(true);
    tableClone.querySelectorAll('.column-hidden').forEach(el => el.remove());
    
    printJS({
        printable: tableClone.outerHTML,
        type: 'raw-html',
        style: `
            table { 
                width: 100%; 
                border-collapse: collapse; 
                font-size: 8px;
                margin: 0;
            }
            th, td { 
                border: 1px solid #000; 
                padding: 2px; 
                text-align: center;
                word-wrap: break-word;
            }
            th { 
                background-color: #f0f0f0; 
                font-weight: bold;
            }
            .column-hidden { 
                display: none !important; 
            }
        `,
        scanStyles: false,
        targetStyles: ['*']
    });
});
}

// Copy to clipboard functionality (EXACT SAME as summary report)
const copyBtn = document.getElementById('copy-detailed-btn');
if (copyBtn) {
copyBtn.addEventListener('click', function() {
    const table = document.getElementById('detailed-report-table');
    if (!table) return;

    let csvContent = '';
    
    const headers = Array.from(table.querySelectorAll('thead th[data-column]'))
        .filter(th => !th.classList.contains('column-hidden'))
        .map(th => `"${th.textContent.trim()}"`);
    csvContent += headers.join(',') + '\n';
    
    const rows = table.querySelectorAll('tbody tr.detailed-row');
    rows.forEach(row => {
        if (row.style.display !== 'none') {
            const cells = Array.from(row.querySelectorAll('td[data-column]'))
                .filter(td => !td.classList.contains('column-hidden'))
                .map(td => {
                    let text = td.textContent.trim();
                    text = text.replace(/\s+/g, ' ').replace(/"/g, '""');
                    return `"${text}"`;
                });
            csvContent += cells.join(',') + '\n';
        }
    });

    navigator.clipboard.writeText(csvContent).then(() => {
        showCopyNotification('Detailed attendance data copied to clipboard!');
    }).catch(err => {
        console.error('Failed to copy: ', err);
        showCopyNotification('Failed to copy data', 'error');
    });
});
}

// Excel export functionality (EXACT SAME as summary report)
const excelBtn = document.getElementById('export-excel-btn');
if (excelBtn) {
excelBtn.addEventListener('click', function() {
    const table = document.getElementById('detailed-report-table');
    if (!table) return;

    let csvContent = '';
    
    const headers = Array.from(table.querySelectorAll('thead th[data-column]'))
        .filter(th => !th.classList.contains('column-hidden'))
        .map(th => `"${th.textContent.trim()}"`);
    csvContent += headers.join(',') + '\n';
    
    const rows = table.querySelectorAll('tbody tr.detailed-row');
    rows.forEach(row => {
        if (row.style.display !== 'none') {
            const cells = Array.from(row.querySelectorAll('td[data-column]'))
                .filter(td => !td.classList.contains('column-hidden'))
                .map(td => {
                    let text = td.textContent.trim();
                    text = text.replace(/\s+/g, ' ').replace(/"/g, '""');
                    return `"${text}"`;
                });
            csvContent += cells.join(',') + '\n';
        }
    });

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', 'employee_detailed_attendance_report.csv');
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    showCopyNotification('Excel file downloaded!');
});
}

// Show copy notification (EXACT SAME as summary report)
function showCopyNotification(message, type = 'success') {
const notification = document.createElement('div');
notification.className = `copy-notification ${type === 'error' ? 'bg-red-500' : 'bg-blue-500'}`;
notification.innerHTML = `
    <div class="flex items-center">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            ${type === 'error' ? 
                '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>' :
                '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>'
            }
        </svg>
        ${message}
    </div>
`;

document.body.appendChild(notification);

setTimeout(() => notification.classList.add('show'), 100);

setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => document.body.removeChild(notification), 300);
}, 3000);
}

// Search functionality
const searchInput = document.getElementById('search-detailed-report');
if (searchInput) {
searchInput.addEventListener('keyup', function() {
    const searchTerm = this.value.toLowerCase();
    const rows = document.querySelectorAll('#detailed-report-table tbody tr.detailed-row');
    rows.forEach(row => {
        const date = row.dataset.date || '';
        const status = row.dataset.status.toLowerCase() || '';
        const shift = row.dataset.shift.toLowerCase() || '';
        if (date.includes(searchTerm) || status.includes(searchTerm) || shift.includes(searchTerm)) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
    updateVisibleRowsCount();
});
}

// Status filter
const statusFilter = document.getElementById('status-filter-detailed');
if (statusFilter) {
statusFilter.addEventListener('change', function() {
    const filterValue = this.value;
    const rows = document.querySelectorAll('#detailed-report-table tbody tr.detailed-row');
    rows.forEach(row => {
        const status = row.dataset.status;
        if (!filterValue || status === filterValue) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
    updateVisibleRowsCount();
});
}

// Shift filter
const shiftFilter = document.getElementById('shift-filter-detailed');
if (shiftFilter) {
shiftFilter.addEventListener('change', function() {
    const filterValue = this.value;
    const rows = document.querySelectorAll('#detailed-report-table tbody tr.detailed-row');
    rows.forEach(row => {
        const shift = row.dataset.shift;
        if (!filterValue || shift === filterValue) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
    updateVisibleRowsCount();
});
}

// Modal creation function (EXACT SAME as summary report)
function createModal(id, title, content, size = 'large') {
const existingModal = document.getElementById(id);
if (existingModal) {
    existingModal.remove();
}

const modal = document.createElement('div');
modal.id = id;
modal.className = 'fixed inset-0 z-50 overflow-auto modal-backdrop hidden';
modal.innerHTML = `
    <div class="bg-white mx-auto mt-10 p-0 border border-gray-200 rounded-xl w-11/12 ${size === 'extra-large' ? 'max-w-7xl' : size === 'large' ? 'max-w-5xl' : 'max-w-lg'} shadow-2xl relative modal-content">
        <div class="bg-white px-6 pt-6 pb-0 border-b border-gray-200 rounded-t-xl relative">
            <h2 class="text-lg font-semibold text-gray-900">${title}</h2>
            <button type="button" class="modal-close-btn absolute right-4 top-4 bg-gray-100 hover:bg-gray-200 border-0 rounded-lg w-8 h-8 flex items-center justify-center cursor-pointer transition-all duration-200 text-gray-600 hover:text-gray-800 hover:scale-105 z-10">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        <div class="bg-white px-6 py-6 max-h-[80vh] overflow-y-auto rounded-b-xl">
            ${content}
        </div>
    </div>
`;
document.body.appendChild(modal);
return modal;
}

// Create the detailed report modal with EXACT same structure as summary report
const detailedReportModal = createModal('detailed-report-modal', 'Employee Detailed Attendance Report Configuration', `
<form id="detailed-report-form" method="post" class="space-y-0">
    {% csrf_token %}
    
    <!-- Header Section -->
    <div class="flex flex-col space-y-1.5 p-6 border-b">
        <h3 class="text-2xl font-semibold leading-none tracking-tight">Employee Detailed Attendance Report</h3>
        <p class="text-sm text-muted-foreground">Comprehensive daily attendance analysis for individual employees with advanced metrics and insights</p>
    </div>

    <div class="max-w-4xl mx-auto bg-white rounded-xl border border-gray-200 shadow-lg">
        
        <!-- Fixed Tab Navigation (EXACT SAME as summary report) -->
        <div class="tab-nav" role="tablist">
            <button type="button" class="tab-button active" data-tab="basic" role="tab" aria-selected="true">
                <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 002 2v12a2 2 0 002 2z"></path>
                </svg>
                Basic Settings
            </button>
            <button type="button" class="tab-button" data-tab="rules" role="tab" aria-selected="false">
                <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Attendance Rules
            </button>
            <button type="button" class="tab-button" data-tab="shifts" role="tab" aria-selected="false">
                <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Shift Detection
            </button>
            <button type="button" class="tab-button" data-tab="overtime" role="tab" aria-selected="false">
                <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Overtime & Breaks
            </button>
            <button type="button" class="tab-button" data-tab="advanced" role="tab" aria-selected="false">
                <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                Advanced
            </button>
        </div>

        <!-- Tab Content Container -->
        <div class="p-8">
            
            <!-- Basic Settings Tab -->
            <div class="tab-content active" id="basic" role="tabpanel">
                <div class="space-y-6">
                    
                    <!-- Employee & Date Range Selection -->
                    <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                        <div class="flex items-center mb-4">
                            <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            <h4 class="font-medium text-gray-900">Employee & Date Range Selection</h4>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Select Employee</label>
                                <select name="employee" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" required>
                                    <option value="">Choose Employee</option>
                                    {% for emp in employees %}
                                    <option value="{{ emp.id }}">{{ emp.employee_id }} - {{ emp.get_full_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Start Date</label>
                                <input type="date" name="start_date" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" required>
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">End Date</label>
                                <input type="date" name="end_date" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" required>
                            </div>
                        </div>
                    </div>

                    <!-- Time Settings (EXACT SAME as summary report) -->
                    <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                        <div class="flex items-center mb-4">
                            <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <h4 class="font-medium text-gray-900">Time Settings</h4>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Grace Minutes</label>
                                <input type="number" name="grace_minutes" value="15" min="0" max="120" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all">
                                <p class="text-xs text-gray-500 mt-1">Late threshold tolerance</p>
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Early Out Threshold (Minutes)</label>
                                <input type="number" name="early_out_threshold_minutes" value="30" min="0" max="240" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all">
                                <p class="text-xs text-gray-500 mt-1">Early departure detection</p>
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Overtime Start After (Minutes)</label>
                                <input type="number" name="overtime_start_after_minutes" value="15" min="0" max="120" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all">
                                <p class="text-xs text-gray-500 mt-1">Grace period before OT</p>
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Minimum Overtime (Minutes)</label>
                                <input type="number" name="minimum_overtime_minutes" value="60" min="0" max="480" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all">
                                <p class="text-xs text-gray-500 mt-1">Minimum OT to qualify</p>
                            </div>
                        </div>
                    </div>

                    <!-- Weekend Configuration (EXACT SAME as summary report) -->
                    <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                        <div class="flex items-center mb-4">
                            <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 002 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <h4 class="font-medium text-gray-900">Weekend Configuration</h4>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                <input type="checkbox" name="weekend_days" value="0" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Monday</span>
                            </label>
                            <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                <input type="checkbox" name="weekend_days" value="1" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Tuesday</span>
                            </label>
                            <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                <input type="checkbox" name="weekend_days" value="2" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Wednesday</span>
                            </label>
                            <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                <input type="checkbox" name="weekend_days" value="3" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Thursday</span>
                            </label>
                            <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                <input type="checkbox" name="weekend_days" value="4" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Friday</span>
                            </label>
                            <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                <input type="checkbox" name="weekend_days" value="5" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Saturday</span>
                            </label>
                            <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                <input type="checkbox" name="weekend_days" value="6" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Sunday</span>
                            </label>
                        </div>
                    </div>

                    <!-- Display Options -->
                    <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                        <div class="flex items-center mb-4">
                            <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                            <h4 class="font-medium text-gray-900">Display Options</h4>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-3">
                                <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" name="show_absent_employees" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Show Absent Days</span>
                                </label>
                                <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" name="show_leave_employees" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Show Leave Days</span>
                                </label>
                                <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" name="show_holiday_status" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Show Holiday Status</span>
                                </label>
                                <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" name="include_roster_info" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Include Roster Information</span>
                                </label>
                            </div>
                            <div class="space-y-3">
                                <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" name="show_shift_analysis" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Show Shift Analysis</span>
                                </label>
                                <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" name="show_raw_logs" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Show Raw Attendance Logs</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Attendance Rules Tab (EXACT SAME as summary report) -->
            <div class="tab-content" id="rules" role="tabpanel">
                <div class="space-y-6">
                    <div class="text-center mb-8">
                        <h3 class="text-2xl font-semibold text-gray-900 mb-2">ðŸ”¥ Attendance Rules</h3>
                        <p class="text-gray-600">Configure advanced attendance processing rules</p>
                    </div>

                    <!-- Minimum Working Hours Rules -->
                    <div class="bg-white rounded-lg p-6 border border-gray-200 transition-all duration-300 hover:-translate-y-1 hover:shadow-lg">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-4">
                            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <label class="flex items-center mb-3 cursor-pointer">
                            <input type="checkbox" name="enable_minimum_working_hours_rule" id="enable_minimum_working_hours" class="h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <span class="ml-2 text-sm font-semibold text-gray-800">ðŸ”¥ Minimum Working Hours Rule</span>
                        </label>
                        <p class="text-xs text-gray-600 mb-3">Mark as Absent if working hours are below threshold</p>
                        <div id="minimum_hours_options" class="hidden">
                            <label class="block mb-1 text-xs font-medium text-gray-700">Minimum Hours for Present</label>
                            <input type="number" name="minimum_working_hours_for_present" value="4" min="1" max="12" step="0.5" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                        </div>
                    </div>

                    <!-- Working Hours Half Day Rule -->
                    <div class="bg-white rounded-lg p-6 border border-gray-200 transition-all duration-300 hover:-translate-y-1 hover:shadow-lg">
                        <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mb-4">
                            <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                            </svg>
                        </div>
                        <label class="flex items-center mb-3 cursor-pointer">
                            <input type="checkbox" name="enable_working_hours_half_day_rule" id="enable_working_hours_half_day" class="h-5 w-5 text-orange-600 focus:ring-orange-500 border-gray-300 rounded">
                            <span class="ml-2 text-sm font-semibold text-gray-800">ðŸ”¥ Working Hours Half Day Rule</span>
                        </label>
                        <p class="text-xs text-gray-600 mb-3">Mark as Half Day based on working hours range</p>
                        <div id="half_day_hours_options" class="hidden grid grid-cols-2 gap-2">
                            <div>
                                <label class="block mb-1 text-xs font-medium text-gray-700">Min Hours</label>
                                <input type="number" name="half_day_minimum_hours" value="4" min="1" max="8" step="0.5" class="w-full rounded-lg border border-gray-300 px-2 py-1.5 text-sm focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200">
                            </div>
                            <div>
                                <label class="block mb-1 text-xs font-medium text-gray-700">Max Hours</label>
                                <input type="number" name="half_day_maximum_hours" value="6" min="2" max="10" step="0.5" class="w-full rounded-lg border border-gray-300 px-2 py-1.5 text-sm focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-200">
                            </div>
                        </div>
                    </div>

                    <!-- Both In/Out Required -->
                    <div class="bg-white rounded-lg p-6 border border-gray-200 transition-all duration-300 hover:-translate-y-1 hover:shadow-lg">
                        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center mb-4">
                            <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" name="require_both_in_and_out" class="h-5 w-5 text-yellow-600 focus:ring-yellow-500 border-gray-300 rounded">
                            <span class="ml-2 text-sm font-semibold text-gray-800">ðŸ”¥ Require Both In & Out Times</span>
                        </label>
                        <p class="text-xs text-gray-600 mt-2">Mark as Absent if either check-in or check-out is missing</p>
                    </div>

                    <!-- Maximum Working Hours -->
                    <div class="bg-white rounded-lg p-6 border border-gray-200 transition-all duration-300 hover:-translate-y-1 hover:shadow-lg">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mb-4">
                            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <label class="flex items-center mb-3 cursor-pointer">
                            <input type="checkbox" name="enable_maximum_working_hours_rule" id="enable_maximum_working_hours" class="h-5 w-5 text-green-600 focus:ring-green-500 border-gray-300 rounded">
                            <span class="ml-2 text-sm font-semibold text-gray-800">ðŸ”¥ Maximum Working Hours Rule</span>
                        </label>
                        <p class="text-xs text-gray-600 mb-3">Flag excessive working hours as potentially erroneous</p>
                        <div id="maximum_hours_options" class="hidden">
                            <label class="block mb-1 text-xs font-medium text-gray-700">Maximum Hours</label>
                            <input type="number" name="maximum_allowable_working_hours" value="16" min="8" max="24" step="0.5" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200">
                        </div>
                    </div>

                    <!-- Consecutive Absence Flagging -->
                    <div class="bg-white rounded-lg p-6 border border-gray-200 transition-all duration-300 hover:-translate-y-1 hover:shadow-lg">
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mb-4">
                            <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                        </div>
                        <label class="flex items-center mb-3 cursor-pointer">
                            <input type="checkbox" name="enable_consecutive_absence_flagging" id="enable_consecutive_absence" class="h-5 w-5 text-purple-600 focus:ring-purple-500 border-gray-300 rounded">
                            <span class="ml-2 text-sm font-semibold text-gray-800">ðŸ”¥ Consecutive Absence Flagging</span>
                        </label>
                        <p class="text-xs text-gray-600 mb-3">Flag employees as termination risk</p>
                        <div id="consecutive_absence_options" class="hidden">
                            <label class="block mb-1 text-xs font-medium text-gray-700">Days for Risk</label>
                            <input type="number" name="consecutive_absence_termination_risk_days" value="5" min="2" max="15" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200">
                        </div>
                    </div>

                    <!-- Early Out Flagging -->
                    <div class="bg-white rounded-lg p-6 border border-gray-200 transition-all duration-300 hover:-translate-y-1 hover:shadow-lg">
                        <div class="w-12 h-12 bg-pink-100 rounded-lg flex items-center justify-center mb-4">
                            <svg class="w-6 h-6 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                            </svg>
                        </div>
                        <label class="flex items-center mb-3 cursor-pointer">
                            <input type="checkbox" name="enable_max_early_out_flagging" id="enable_max_early_out" class="h-5 w-5 text-pink-600 focus:ring-pink-500 border-gray-300 rounded">
                            <span class="ml-2 text-sm font-semibold text-gray-800">ðŸ”¥ Max Early Out Flagging</span>
                        </label>
                        <p class="text-xs text-gray-600 mb-3">Flag excessive early out occurrences</p>
                        <div id="early_out_options" class="hidden grid grid-cols-2 gap-2">
                            <div>
                                <label class="block mb-1 text-xs font-medium text-gray-700">Threshold (Min)</label>
                                <input type="number" name="max_early_out_threshold_minutes" value="120" min="30" max="300" class="w-full rounded-lg border border-gray-300 px-2 py-1.5 text-sm focus:outline-none focus:border-pink-500 focus:ring-2 focus:ring-pink-200">
                            </div>
                            <div>
                                <label class="block mb-1 text-xs font-medium text-gray-700">Max Count</label>
                                <input type="number" name="max_early_out_occurrences" value="3" min="1" max="10" class="w-full rounded-lg border border-gray-300 px-2 py-1.5 text-sm focus:outline-none focus:border-pink-500 focus:ring-2 focus:ring-pink-200">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Shift Detection Tab (EXACT SAME as summary report) -->
            <div class="tab-content" id="shifts" role="tabpanel">
                <div class="space-y-6">
                    <div class="text-center mb-8">
                        <h3 class="text-2xl font-semibold text-gray-900 mb-2">Shift Detection</h3>
                        <p class="text-gray-600">Configure dynamic shift detection settings</p>
                    </div>
                    
                    <!-- Dynamic Shift Detection -->
                    <div class="bg-white rounded-lg p-6 border border-gray-200">
                        <div class="flex items-center mb-4">
                            <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                            <h4 class="font-medium text-gray-900">Dynamic Shift Detection</h4>
                        </div>
                        <label class="flex items-center cursor-pointer mb-4">
                            <input type="checkbox" name="enable_dynamic_shift_detection" id="enable_dynamic_shift" class="h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <span class="ml-3 text-sm font-medium text-gray-900">Enable Automatic Shift Detection</span>
                        </label>
                        <p class="text-sm text-gray-600 mb-4">Automatically detect shifts based on actual check-in/out times instead of roster assignments</p>
                        
                        <div id="dynamic_shift_options" class="hidden space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block mb-2 text-sm font-medium text-gray-700">Tolerance (Minutes)</label>
                                    <input type="number" name="dynamic_shift_tolerance_minutes" value="30" min="5" max="120" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                                    <p class="text-xs text-gray-500 mt-1">Time tolerance for matching attendance to shifts</p>
                                </div>
                                <div>
                                    <label class="block mb-2 text-sm font-medium text-gray-700">Multiple Match Priority</label>
                                    <select name="multiple_shift_priority" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                                        <option value="least_break">Least Break Time</option>
                                        <option value="shortest_duration">Shortest Duration</option>
                                        <option value="alphabetical">Alphabetical Order</option>
                                    </select>
                                    <p class="text-xs text-gray-500 mt-1">How to choose when multiple shifts match</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Overtime & Breaks Tab (EXACT SAME as summary report) -->
            <div class="tab-content" id="overtime" role="tabpanel">
                <div class="space-y-6">
                    <div class="text-center mb-8">
                        <h3 class="text-2xl font-semibold text-gray-900 mb-2">Overtime & Break Management</h3>
                        <p class="text-gray-600">Configure overtime calculation and break time settings</p>
                    </div>
                    
                    <!-- Overtime Configuration -->
                    <div class="bg-white rounded-lg p-6 border border-gray-200">
                        <div class="flex items-center mb-4">
                            <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <h4 class="font-medium text-gray-900">Overtime Configuration</h4>
                        </div>
                        <div class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block mb-2 text-sm font-medium text-gray-700">Calculation Method</label>
                                    <select name="overtime_calculation_method" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                                        <option value="shift_based">Shift-Based (After shift end)</option>
                                        <option value="expected_hours">Expected Hours-Based</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mb-2 text-sm font-medium text-gray-700">Separate OT Break (Minutes)</label>
                                    <input type="number" name="separate_ot_break_time" value="0" min="0" max="120" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <label class="flex items-center p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" name="holiday_overtime_full_day" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Holiday OT - Full Day</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" name="weekend_overtime_full_day" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Weekend OT - Full Day</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" name="late_affects_overtime" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Late Affects OT</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Break Time Management -->
                    <div class="bg-white rounded-lg p-6 border border-gray-200">
                        <div class="flex items-center mb-4">
                            <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                            </svg>
                            <h4 class="font-medium text-gray-900">Break Time Management</h4>
                        </div>
                        <div class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block mb-2 text-sm font-medium text-gray-700">Default Break Time (Minutes)</label>
                                    <input type="number" name="default_break_minutes" value="60" min="0" max="240" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                                </div>
                                <div>
                                    <label class="block mb-2 text-sm font-medium text-gray-700">Deduction Method</label>
                                    <select name="break_deduction_method" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                                        <option value="fixed">Fixed Break Time</option>
                                        <option value="proportional">Proportional to Hours</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div>
                                <label class="flex items-center p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" name="use_shift_break_time" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Use Shift-Specific Break Time</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Tab (EXACT SAME as summary report) -->
            <div class="tab-content" id="advanced" role="tabpanel">
                <div class="space-y-6">
                    <div class="text-center mb-8">
                        <h3 class="text-2xl font-semibold text-gray-900 mb-2">Advanced Settings</h3>
                        <p class="text-gray-600">Configure advanced rules and employee overrides</p>
                    </div>
                    
                    <!-- Advanced Rules -->
                    <div class="bg-white rounded-lg p-6 border border-gray-200">
                        <div class="flex items-center mb-4">
                            <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            <h4 class="font-medium text-gray-900">Advanced Rules</h4>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-700">Late to Absent Conversion (Days)</label>
                                <input type="number" name="late_to_absent_days" value="3" min="1" max="10" class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2.5 text-sm text-gray-700 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200">
                                <p class="text-xs text-gray-500 mt-1">Convert to absent after consecutive late days</p>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <label class="flex items-center p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" name="holiday_before_after_absent" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Holiday Before/After Absent Rule</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" name="weekend_before_after_absent" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Weekend Before/After Absent Rule</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Employee Override Settings -->
                    <div class="bg-white rounded-lg p-6 border border-gray-200">
                        <div class="flex items-center mb-4">
                            <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                            </svg>
                            <h4 class="font-medium text-gray-900">Employee Override Settings</h4>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <label class="flex items-center p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                <input type="checkbox" name="use_employee_specific_grace" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Employee-Specific Grace</span>
                            </label>
                            <label class="flex items-center p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                <input type="checkbox" name="use_employee_specific_overtime" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Employee-Specific OT</span>
                            </label>
                            <label class="flex items-center p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-blue-50 transition-all cursor-pointer">
                                <input type="checkbox" name="use_employee_expected_hours" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">Employee Expected Hours</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="flex gap-3 pt-6 border-t border-gray-200">
        <button type="submit" class="flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 rounded-lg text-sm font-medium bg-gradient-to-r from-blue-600 to-blue-700 text-white hover:from-blue-700 hover:to-blue-800 h-12 px-8 py-3 shadow-lg transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none">
                <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke="currentColor" stroke-width="2"/>
            </svg>
            Generate Detailed Report
        </button>
        <button type="button" class="modal-close-btn flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 rounded-lg text-sm font-medium border border-gray-300 bg-white hover:bg-gray-50 text-gray-700 h-12 px-8 py-3 shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
            Cancel
        </button>
    </div>
</form>
`, 'extra-large');

// Tab functionality (EXACT SAME as summary report)
document.addEventListener('click', function(e) {
if (e.target.classList.contains('tab-button') || e.target.closest('.tab-button')) {
    e.preventDefault();
    e.stopPropagation();
    
    const tabButton = e.target.classList.contains('tab-button') ? e.target : e.target.closest('.tab-button');
    const targetTab = tabButton.dataset.tab;
    
    // Update tab buttons
    document.querySelectorAll('.tab-button').forEach(tab => {
        tab.classList.remove('active');
        tab.setAttribute('aria-selected', 'false');
    });
    
    tabButton.classList.add('active');
    tabButton.setAttribute('aria-selected', 'true');
    
    // Update tab panels
    document.querySelectorAll('.tab-content').forEach(panel => {
        panel.classList.remove('active');
    });
    
    const targetPanel = document.getElementById(targetTab);
    if (targetPanel) {
        targetPanel.classList.add('active');
    }
}
});

// Dynamic field visibility (EXACT SAME as summary report)
document.addEventListener('change', function(e) {
if (e.target.id === 'enable_dynamic_shift') {
    const dynamicOptions = document.getElementById('dynamic_shift_options');
    if (dynamicOptions) {
        if (e.target.checked) {
            dynamicOptions.classList.remove('hidden');
        } else {
            dynamicOptions.classList.add('hidden');
        }
    }
}

// Toggle options based on checkbox states
if (e.target.id === 'enable_minimum_working_hours') {
    const options = document.getElementById('minimum_hours_options');
    if (options) options.classList.toggle('hidden', !e.target.checked);
}

if (e.target.id === 'enable_working_hours_half_day') {
    const options = document.getElementById('half_day_hours_options');
    if (options) options.classList.toggle('hidden', !e.target.checked);
}

if (e.target.id === 'enable_maximum_working_hours') {
    const options = document.getElementById('maximum_hours_options');
    if (options) options.classList.toggle('hidden', !e.target.checked);
}

if (e.target.id === 'enable_consecutive_absence') {
    const options = document.getElementById('consecutive_absence_options');
    if (options) options.classList.toggle('hidden', !e.target.checked);
}

if (e.target.id === 'enable_max_early_out') {
    const options = document.getElementById('early_out_options');
    if (options) options.classList.toggle('hidden', !e.target.checked);
}
});

// Modal close handlers (EXACT SAME as summary report)
document.addEventListener('click', function(e) {
// Close button handler
if (e.target.classList.contains('modal-close-btn') || e.target.closest('.modal-close-btn')) {
    e.preventDefault();
    e.stopPropagation();
    const modal = e.target.closest('.modal-backdrop');
    if (modal) {
        modal.classList.add('hidden');
    }
}

// Backdrop click handler
if (e.target.classList.contains('modal-backdrop')) {
    e.target.classList.add('hidden');
}
});

// Prevent modal from closing when clicking inside modal content
document.addEventListener('click', function(e) {
if (e.target.classList.contains('modal-content') || e.target.closest('.modal-content')) {
    e.stopPropagation();
}
});

// Generate report button handler
const generateBtn = document.getElementById('generate-detailed-report-btn');
if (generateBtn) {
generateBtn.addEventListener('click', function(e) {
    e.preventDefault();
    detailedReportModal.classList.remove('hidden');
    
    // Set default date range to current month
    const today = new Date();
    const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
    const defaultStartDate = firstDay.toISOString().split('T')[0];
    const defaultEndDate = today.toISOString().split('T')[0];
    
    const startDateInput = document.querySelector('#detailed-report-modal input[name="start_date"]');
    const endDateInput = document.querySelector('#detailed-report-modal input[name="end_date"]');
    
    if (startDateInput && !startDateInput.value) {
        startDateInput.value = defaultStartDate;
    }
    if (endDateInput && !endDateInput.value) {
        endDateInput.value = defaultEndDate;
    }
});
}

// Form submission handler
document.addEventListener('submit', function(e) {
if (e.target.id === 'detailed-report-form') {
    detailedReportModal.classList.add('hidden');
    loadingOverlay.classList.add('active');
    
    // Remove loading overlay after a reasonable time
    setTimeout(() => {
        loadingOverlay.classList.remove('active');
    }, 3000);
}
});

// Escape key handler for modal
document.addEventListener('keydown', function(e) {
if (e.key === 'Escape') {
    const visibleModal = document.querySelector('.modal-backdrop:not(.hidden)');
    if (visibleModal) {
        visibleModal.classList.add('hidden');
    }
}
});

// Initialize column visibility on page load
if (document.getElementById('detailed-report-table')) {
initializeColumnVisibility();
updateVisibleRowsCount();
}

});
</script>
{% endblock %}

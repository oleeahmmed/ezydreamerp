{% extends "common/base-list-modern.html" %}
{% load static %}
{% load i18n %}

{% block list_icon %}
<svg class="w-6 h-6 sm:w-7 sm:h-7" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M9 11L12 14L22 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M21 12V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
{% endblock %}

{% block list_title %}{% trans "ZK Devices" %}{% endblock %}
{% block list_subtitle %}{% trans "Manage biometric device connections" %}{% endblock %}



{% block search_filter %}
<div class="flex flex-wrap items-center gap-2 my-4">


    <a href="{% url 'hrm:zk_device_sync' %}" class="inline-flex items-center justify-center rounded-lg text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-to-r from-[hsl(var(--accent-sync)/0.8)] to-[hsl(var(--accent-sync)/1.2)] text-[hsl(var(--accent-sync-foreground))] hover:opacity-90 h-10 px-4 py-2 shadow-md premium-button" aria-label="Sync devices">
        <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 4V20H20V4H4ZM4 4L20 20M4 20L20 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {% trans "Sync Devices" %}
    </a>

    <a href="{% url 'hrm:zk_device_test_connection' %}" class="inline-flex items-center justify-center rounded-lg text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-to-r from-[hsl(var(--accent-test)/0.8)] to-[hsl(var(--accent-test)/1.2)] text-[hsl(var(--accent-test-foreground))] hover:opacity-90 h-10 px-4 py-2 shadow-md premium-button" aria-label="Test device connection">
        <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {% trans "Test Connection" %}
    </a>
    <a href="{% url 'hrm:zk_user_list_device' %}" class="inline-flex items-center justify-center rounded-lg text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-to-r from-[hsl(var(--accent-users)/0.8)] to-[hsl(var(--accent-users)/1.2)] text-[hsl(var(--accent-users-foreground))] hover:opacity-90 h-10 px-4 py-2 shadow-md premium-button" aria-label="View user list">
        <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M16 21V19A4 4 0 0012 15A4 4 0 008 19V21M12 11A4 4 0 0012 3A4 4 0 0012 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {% trans "User List Device" %}
    </a>
    <a href="{% url 'hrm:zk_attendance_log_list' %}" class="inline-flex items-center justify-center rounded-lg text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-to-r from-[hsl(var(--accent-logs)/0.8)] to-[hsl(var(--accent-logs)/1.2)] text-[hsl(var(--accent-logs-foreground))] hover:opacity-90 h-10 px-4 py-2 shadow-md premium-button" aria-label="View attendance logs">
        <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 4H20V20H4V4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 2V6M16 2V6M3 10H21M12 14H12.01M8 18H8.01M16 18H16.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {% trans "Attendance Logs" %}
    </a>

    <a href="{% url 'hrm:zk_user_sync' %}" class="inline-flex items-center justify-center rounded-lg text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-to-r from-[hsl(var(--accent-users)/0.8)] to-[hsl(var(--accent-users)/1.2)] text-[hsl(var(--accent-users-foreground))] hover:opacity-90 h-10 px-4 py-2 shadow-md premium-button" aria-label="Sync users">
        <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M17 7A5 5 0 0012 12M17 7C17 7.67 16.85 8.32 16.59 8.89L19 11.29M12 12A5 5 0 007 7M12 12H15.41M7 7C7 6.33 7.15 5.68 7.41 5.11L5 2.71M12 12H8.59" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {% trans "Sync Users" %}
    </a>

        <a href="{% url 'hrm:report-list' %}" class="inline-flex items-center justify-center rounded-lg text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-to-r from-[hsl(var(--accent-users)/0.8)] to-[hsl(var(--accent-users)/1.2)] text-[hsl(var(--accent-users-foreground))] hover:opacity-90 h-10 px-4 py-2 shadow-md premium-button" aria-label="Sync users">
        <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M17 7A5 5 0 0012 12M17 7C17 7.67 16.85 8.32 16.59 8.89L19 11.29M12 12A5 5 0 007 7M12 12H15.41M7 7C7 6.33 7.15 5.68 7.41 5.11L5 2.71M12 12H8.59" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {% trans "Reports" %}
    </a>



    <!-- {% if can_export %}
    <a href="{% url 'hrm:zk_device_export' %}" class="inline-flex items-center justify-center rounded-lg text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-to-r from-[hsl(var(--secondary)/0.8)] to-[hsl(var(--secondary)/1.2)] text-[hsl(var(--secondary-foreground))] hover:opacity-90 h-10 px-4 py-2 shadow-md premium-button" aria-label="Export to CSV">
        <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M7 10L12 15L17 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {% trans "Export CSV" %}
    </a>
    {% endif %}

    {% if can_bulk_delete %}
    <button id="bulk-delete-button" class="inline-flex items-center justify-center rounded-lg text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-gradient-to-r from-[hsl(var(--accent-delete)/0.8)] to-[hsl(var(--accent-delete)/1.2)] text-[hsl(var(--accent-delete-foreground))] hover:opacity-90 h-10 px-4 py-2 shadow-md premium-button" aria-label="Bulk delete items">
        <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {% trans "Bulk Delete" %}
    </button>
    {% endif %} -->
</div>
<div class="mb-6">
    <form method="get" class="flex flex-col sm:flex-row gap-3 sm:gap-4">
        <div class="relative flex-grow">
            <input type="text" name="search" placeholder="{% trans 'Search devices...' %}" value="{{ request.GET.search|default:'' }}" class="w-full px-3 py-2 rounded-md border-2 border-[hsl(var(--border))] bg-transparent text-[hsl(var(--foreground))] transition-all duration-200 focus:outline-none focus:border-[hsl(var(--primary))] focus:ring-1 focus:ring-[hsl(var(--primary))]">
            <button type="submit" class="absolute right-2 top-2 text-[hsl(var(--muted-foreground))]">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
        <div class="filters-container overflow-x-auto hide-scrollbar -mx-4 px-4 pb-2">
            <div class="flex flex-nowrap gap-3 min-w-max">
                <select name="is_active" class="px-3 py-2 rounded-md border-2 border-[hsl(var(--border))] bg-transparent text-[hsl(var(--foreground))] transition-all duration-200 focus:outline-none focus:border-[hsl(var(--primary))] focus:ring-1 focus:ring-[hsl(var(--primary))]">
                    <option value="">{% trans "All Status" %}</option>
                    <option value="true" {% if request.GET.is_active == "true" %}selected{% endif %}>{% trans "Active" %}</option>
                    <option value="false" {% if request.GET.is_active == "false" %}selected{% endif %}>{% trans "Inactive" %}</option>
                </select>
                <button type="submit" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-[hsl(var(--border))] bg-[hsl(var(--background))] hover:bg-[hsl(var(--accent))] hover:text-[hsl(var(--accent-foreground))] h-10 px-4 py-2 whitespace-nowrap">
                    <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 4H21M3 12H21M3 20H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    {% trans "Filter" %}
                </button>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block table_headers %}
<tr class="text-xs uppercase bg-[hsl(var(--muted))] text-[hsl(var(--muted-foreground))]">
    <th scope="col" class="px-3 sm:px-6 py-3">
        <input type="checkbox" id="select-all" class="rounded border-[hsl(var(--border))] text-[hsl(var(--primary))] shadow-sm focus:border-[hsl(var(--primary))] focus:ring focus:ring-[hsl(var(--primary))] focus:ring-opacity-50">
    </th>
    <th scope="col" class="px-3 sm:px-6 py-3">{% trans "Name" %}</th>
    <th scope="col" class="px-3 sm:px-6 py-3">{% trans "IP Address" %}</th>
    <th scope="col" class="px-3 sm:px-6 py-3">{% trans "Port" %}</th>
    <th scope="col" class="px-3 sm:px-6 py-3">{% trans "Active" %}</th>
    <th scope="col" class="px-3 sm:px-6 py-3">{% trans "Last Sync" %}</th>
    <th scope="col" class="px-3 sm:px-6 py-3 text-right">{% trans "Actions" %}</th>
</tr>
{% endblock %}

{% block table_body %}
<form id="bulk-delete-form" action="{% url 'hrm:zk_device_bulk_delete' %}" method="get">
    {% for device in objects %}
    <tr class="bg-[hsl(var(--background))] border-b border-[hsl(var(--border))] hover:bg-[hsl(var(--accent))]">
        <td class="px-3 sm:px-6 py-4">
            <input type="checkbox" name="ids" value="{{ device.id }}" class="item-checkbox rounded border-[hsl(var(--border))] text-[hsl(var(--primary))] shadow-sm focus:border-[hsl(var(--primary))] focus:ring focus:ring-[hsl(var(--primary))] focus:ring-opacity-50">
        </td>
        <td class="px-3 sm:px-6 py-4 font-medium text-[hsl(var(--foreground))]">{{ device.name }}</td>
        <td class="px-3 sm:px-6 py-4 text-[hsl(var(--foreground))]">{{ device.ip_address }}</td>
        <td class="px-3 sm:px-6 py-4 text-[hsl(var(--foreground))]">{{ device.port }}</td>
        <td class="px-3 sm:px-6 py-4">
            {% if device.is_active %}
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">{% trans "Active" %}</span>
            {% else %}
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">{% trans "Inactive" %}</span>
            {% endif %}
        </td>
        <td class="px-3 sm:px-6 py-4 text-[hsl(var(--foreground))]">
            {% if device.last_sync %}
            {{ device.last_sync|date:"Y-m-d H:i" }}
            {% else %}
            <span class="text-[hsl(var(--muted-foreground))]">{% trans "Never" %}</span>
            {% endif %}
        </td>
        <td class="px-3 sm:px-6 py-4 text-right">
            <div class="flex justify-end gap-1 sm:gap-2">
                {% if can_view %}
                <a href="{% url 'hrm:zk_device_detail' device.pk %}" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-[hsl(var(--border))] bg-[hsl(var(--background))] hover:bg-[hsl(var(--accent))] hover:text-[hsl(var(--accent-foreground))] h-9 w-9">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path d="M2 12S5.636 5 12 5s10 7 10 7-3.636 7-10 7S2 12 2 12Z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="12" cy="12" r="3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="sr-only">{% trans "View" %}</span>
                </a>
                {% endif %}

                {% if can_update %}
                <a href="{% url 'hrm:zk_device_update' device.pk %}" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-[hsl(var(--border))] bg-[hsl(var(--background))] hover:bg-[hsl(var(--accent))] hover:text-[hsl(var(--accent-foreground))] h-9 w-9">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7M18.5 2.5a2 2 0 012.5 2.5l-9 9-4 1 1-4 9-9Z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="sr-only">{% trans "Edit" %}</span>
                </a>
                {% endif %}

                {% if can_delete %}
                <a href="{% url 'hrm:zk_device_delete' device.pk %}" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offse
t-background transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-[hsl(var(--border))] bg-[hsl(var(--background))] hover:bg-red-100 hover:text-red-700 h-9 w-9">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path d="M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m1 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="sr-only">{% trans "Delete" %}</span>
                </a>
                {% endif %}
            </div>
        </td>
    </tr>
    {% empty %}
    <tr class="bg-[hsl(var(--background))] border-b border-[hsl(var(--border))]">
        <td colspan="7" class="px-3 sm:px-6 py-4 text-center text-[hsl(var(--muted-foreground))]">
            {% trans "No devices found." %} {% if can_create %}<a href="{% url 'hrm:zk_device_create' %}" class="text-[hsl(var(--primary))] hover:underline">{% trans "Add one now" %}</a>.{% endif %}
        </td>
    </tr>
    {% endfor %}
</form>
{% endblock %}

{% block empty_colspan %}7{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const selectAllCheckbox = document.getElementById('select-all');
    const itemCheckboxes = document.querySelectorAll('.item-checkbox');
    const bulkDeleteForm = document.getElementById('bulk-delete-form');
    const bulkDeleteButton = document.getElementById('bulk-delete-button');

    if (selectAllCheckbox && bulkDeleteButton) {
        selectAllCheckbox.addEventListener('change', function() {
            itemCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
        });

        bulkDeleteButton.addEventListener('click', function(e) {
            e.preventDefault();
            const checkedBoxes = document.querySelectorAll('.item-checkbox:checked');
            if (checkedBoxes.length === 0) {
                alert('{% trans "Please select at least one device to delete." %}');
                return;
            }
            if (confirm('{% trans "Are you sure you want to delete the selected devices?" %}')) {
                bulkDeleteForm.submit();
            }
        });
    }
});
</script>
{% endblock %}